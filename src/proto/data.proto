syntax = "proto3";
package oceandoc.proto;

enum FileType {
  FT_Unused = 0;
  Regular = 1;
  Symlink = 2;
  Dir = 3;
}

message FileItem {
  string path = 1;
  uint64 size = 2;
  uint64 update_time = 4;  // local update time
  FileType file_type = 5;
  string owner = 6;
  string sha256 = 7;
  string encrypted_sha256 = 8;
  uint32 permission = 9;  // 1bit: need auth, 2bit: group, 3bit: all
}

message DirItem {
  string path = 1;
  uint64 update_time = 2;  // local update time
  string owner = 3;
  uint32 permission = 4;  // 1bit: need auth, 2bit: group, 3bit: all
  map<string, int64> files = 5;
}

message ScanStatus {
  string path = 1;
  map<string, DirItem> scanned_dirs = 2;    // relative path
  map<string, FileItem> scanned_files = 3;  // relative path
  int64 update_time = 4;
  int64 complete_time = 5;
  map<string, bool> ignored_dirs = 6;  // relative path
  string uuid = 7;
}

message RepoMeta {
  string name = 1;
  string path = 2;
  string uuid = 3;
  string create_time = 4;
  int64 update_time = 5;
}

message RepoData {
  string name = 1;
  string path = 2;
  string uuid = 3;
  uint64 file_num = 4;
  repeated FileItem files = 5;
  repeated DirItem dirs = 6;
}

message Repos {
  map<string, RepoMeta> repos = 1;
  map<string, RepoMeta> uuid_repos = 2;
}

message RepoDatas {
  map<string, RepoData> uuid_repos_data = 1;
}
